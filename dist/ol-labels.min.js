function resolutionToMinT(e){var t=Math.log2(156543.03390625)-Math.log2(e);return t<=3?1e4:Math.pow(2,9-(t-1))}ol.control.defaults=function(e){var t=e||{},n=new ol.Collection;return(void 0===t.zoom||t.zoom)&&n.push(new ol.control.Zoom(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&n.push(new ol.control.Rotate(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&n.push(new ol.control.Attribution(t.attributionOptions)),n},ol.control.LabelDebug=function(e){var t=e||{};void 0!==t.className&&t.className;this.state={open:!1,isDemoModeRunning:!1},this.btn=document.createElement("button"),this.btn.className="menu-toggle-button",this.buttonIcon={openMenu:">_",closeMenu:"X"},this.btn.innerHTML=this.buttonIcon.openMenu,ol.events.listen(this.btn,ol.events.EventType.CLICK,this.toggleMenu,this),this.container=document.createElement("div"),this.container.className="ol-label-debug ol-control ol-collapsed",this.menu=document.createElement("div"),this.menu.className="",this.container.appendChild(this.btn),this.container.appendChild(this.menu),ol.control.Control.call(this,{element:this.container,target:t.target})},ol.inherits(ol.control.LabelDebug,ol.control.Control),ol.control.LabelDebug.prototype.toggleMenu=function(){!0===this.state.open?this.closeMenu():this.openMenu(),this.state.open=!this.state.open},ol.control.LabelDebug.prototype.openMenu=function(){this.btn.innerHTML=this.buttonIcon.closeMenu,this.menu.style.display="",0==this.menu.innerHTML.length&&this.renderMenuContents()},ol.control.LabelDebug.prototype.closeMenu=function(){this.btn.innerHTML=this.buttonIcon.openMenu,this.menu.style.display="none"},ol.control.LabelDebug.prototype.renderMenuContents=function(){var e=this.getMap(),t={width:"300px"},n=document.createElement("div");Object.assign(n.style,{margin:"10px"});var o=n.cloneNode(),i=document.createElement("input");i.setAttribute("type","checkbox"),i.id="drawCirclesCheckbox";var a=document.createElement("label");a.htmlFor="drawCirclesCheckbox",a.appendChild(i),a.appendChild(document.createTextNode("Draw circles around the labels.")),o.appendChild(a),ol.events.listen(i,ol.events.EventType.CHANGE,ol.control.LabelDebug.prototype.toggleDrawCircles_.bind(this)),window.debugDrawCirc=!1;var l=n.cloneNode(),r=document.createElement("input");Object.assign(r.style,t),r.setAttribute("type","range"),r.setAttribute("id","labelfactorRange"),r.setAttribute("min","0.0"),r.setAttribute("max","3.0"),r.setAttribute("step","0.1"),r.defaultValue="1.1";var s=document.createElement("label");s.id="sliderLabel",s.htmlFor="labelfactorRange",s.appendChild(document.createTextNode("Set the coefficient of the labelFactor. (1.1)")),l.appendChild(s),l.appendChild(document.createElement("br")),l.appendChild(r),ol.events.listen(r,"input",ol.control.LabelDebug.prototype.changeLabelFactor_.bind(this)),window.labelFacCoeff=1.1;var c=n.cloneNode(),u=document.createElement("input");Object.assign(u.style,t),u.setAttribute("type","range"),u.setAttribute("id","minTFactorRange"),u.setAttribute("min","0.0"),u.setAttribute("max","20"),u.setAttribute("step","0.1"),u.defaultValue="9";var d=document.createElement("label");d.id="minTLabel",d.htmlFor="minTFactorRange",d.appendChild(document.createTextNode("Set the offset for the calculation of the min_t. (9)")),ol.events.listen(u,"input",ol.control.LabelDebug.prototype.changeMinTFactor_.bind(this)),c.appendChild(d),c.appendChild(document.createElement("br")),c.appendChild(u),window.minTFac=9;var h=n.cloneNode(),p=document.createElement("input");Object.assign(p.style,t),p.setAttribute("type","range"),p.setAttribute("id","minTCoeffRange"),p.setAttribute("min","0.0"),p.setAttribute("max","5"),p.setAttribute("step","0.1"),p.defaultValue="1.0";var m=document.createElement("label");m.id="minTCoeffLabel",m.htmlFor="minTCoeffRange",m.appendChild(document.createTextNode("Set the coefficient for the calculation of the min_t. (1.0)")),ol.events.listen(p,"input",ol.control.LabelDebug.prototype.changeMinTCoeff_.bind(this)),h.appendChild(m),h.appendChild(document.createElement("br")),h.appendChild(p),window.minTCoeff=1;var g=n.cloneNode(),b=document.createElement("input");Object.assign(b.style,{"margin-left":"10px",width:"50px"}),b.setAttribute("type","number"),b.setAttribute("id","zoomLevelDelta"),b.setAttribute("min","0.0"),b.setAttribute("max","10.0"),b.setAttribute("step","0.1"),b.setAttribute("value","1.0");var v=document.createElement("input");Object.assign(v.style,{width:"600px","margin-top":"10px"}),v.setAttribute("type","range"),v.setAttribute("id","zoomSliderInput"),v.setAttribute("min",0),v.setAttribute("max",28),v.setAttribute("step",b.value),v.defaultValue=e.getView().getZoom();var f=document.createElement("label");f.id="zoomSliderLabel",f.htmlFor="zoomSliderInput",f.appendChild(document.createTextNode("Use the slider to change the zoom level with the defined zoom delta:"));var y=document.createElement("label");Object.assign(y.style,{"margin-left":"10px",position:"relative",top:"-6px"}),y.id="zoomLevelLabel",y.htmlFor="zoomLevelLabel",y.appendChild(document.createTextNode("zoom: "+e.getView().getZoom())),ol.events.listen(b,"input",function(){v.setAttribute("step",b.value)}),ol.events.listen(v,"input",function(){document.getElementById("zoomLevelLabel").innerHTML="zoom: "+v.value,e.getView().setZoom(v.value)}),e.on("moveend",function(t){var n=e.getView().getZoom();n=Math.round(1e3*n)/1e3,document.getElementById("zoomLevelLabel").innerHTML="zoom: "+n,document.getElementById("zoomSliderInput").value=n}),g.appendChild(f),g.appendChild(b),g.appendChild(document.createElement("br")),g.appendChild(v),g.appendChild(y);var L=n.cloneNode(),C=document.createElement("button");C.className="demo-mode-button",C.id="demoModeControlBtn",C.innerHTML="&#9658";var M=document.createElement("label");M.id="demoModeControlLabel",M.htmlFor="demoModeControlBtn",M.innerHTML="Demo mode: ",ol.events.listen(C,ol.events.EventType.CLICK,function(){E.state.isDemoModeRunning?(C.innerHTML="&#9658;",E.stopDemoMode_()):(C.innerHTML="&#10074;&#10074;",E.startDemoMode_());E.state.isDemoModeRunning=!E.state.isDemoModeRunning});var E=this;L.appendChild(M),L.appendChild(C);var T=document.createElement("div");T.appendChild(o),T.appendChild(l),T.appendChild(c),T.appendChild(h),T.appendChild(g),T.appendChild(L),this.menu.appendChild(T),resolutionToMinT=this.resolutionToMinT,calculateLabelFactor=this.calculateLabelFactor},ol.control.LabelDebug.prototype.toggleDrawCircles_=function(e){e.preventDefault(),window.debugDrawCirc=document.getElementById("drawCirclesCheckbox").checked,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.changeLabelFactor_=function(e){e.preventDefault();var t=document.getElementById("labelfactorRange");document.getElementById("sliderLabel").innerHTML="Set the coefficient of the labelFactor. ("+t.value+")",window.labelFacCoeff=t.value,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.changeMinTFactor_=function(e){e.preventDefault();var t=document.getElementById("minTFactorRange");document.getElementById("minTLabel").innerHTML="Set the offset for the calculation of the min_t. ("+t.value+")",window.minTFac=t.value,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.changeMinTCoeff_=function(e){e.preventDefault();var t=document.getElementById("minTCoeffRange");document.getElementById("minTCoeffLabel").innerHTML="Set the coefficient for the calculation of the min_t. ("+t.value+")",window.minTCoeff=t.value,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.updateLabelLayer_=function(){this.getMap().getLayers().forEach(function(e){e instanceof ol.layer.Label&&e.getSource().refresh()})},ol.control.LabelDebug.prototype.resolutionToMinT=function(e){var t=Math.log2(156543.03390625)-Math.log2(e);return t<=3?1e4:window.minTCoeff*Math.pow(2,window.minTFac-(t-1))},ol.control.LabelDebug.prototype.calculateLabelFactor=function(e){var t=e.get("lbl_fac");return parseInt(t)*window.labelFacCoeff},ol.control.LabelDebug.prototype.startDemoMode_=function(){var e=this,t=this.getMap().getView(),n=(t.getRotation(),t.getCenter()),o=3e3,i=Math.round(6*Math.random())+4;o*=Math.abs(14-i);var a,l,r,s,c=(a=[8,12],l=[48,54],r=Math.random()*(a[1]-a[0]+1)+a[0],s=Math.random()*(l[1]-l[0]+1)+l[0],ol.proj.fromLonLat([r,s])),u=(Math.round(100*new ol.geom.LineString([n,c]).getLength()),Math.random()*(2*Math.PI));t.animate({center:c,duration:2*o,rotation:u},function(){setTimeout(function(){e.state.isDemoModeRunning&&e.startDemoMode_()},1)}),t.animate({zoom:i,duration:o},{zoom:14,duration:o})},ol.control.LabelDebug.prototype.stopDemoMode_=function(){var e=this.getMap().getView();e.setResolution(e.getResolution())},ol.control.LayerMenu=function(e){var t=e||{};this.state={open:!1,layers:[]},this.btn=document.createElement("button"),this.btn.innerHTML="&#9776;";ol.events.listen(this.btn,ol.events.EventType.CLICK,this.toggleMenu,this),this.container=document.createElement("div"),this.container.className="ol-layer-menu ol-control ol-collapsed",this.menu=document.createElement("div"),this.menu.className="layer-menu",this.container.appendChild(this.menu),this.container.appendChild(this.btn),ol.control.Control.call(this,{element:this.container,target:t.target})},ol.inherits(ol.control.LayerMenu,ol.control.Control),ol.control.LayerMenu.prototype.toggleMenu=function(){!0===this.state.open?this.closeMenu():this.openMenu(),this.state.open=!this.state.open},ol.control.LayerMenu.prototype.activateLayerLabel=function(e){void 0!=e.target.value&&(selectedOpt=e.target.value,checked=e.target.checked,this.state.layers.getArray().filter(e=>e instanceof ol.layer.Label).forEach(e=>{e.get("title")==selectedOpt?e.setVisible(!0):e.setVisible(!1)}))},ol.control.LayerMenu.prototype.activateLayer=function(e){void 0!=e.target.value&&(selectedOpt=e.target.value,checked=e.target.checked,this.state.layers.getArray().filter(e=>!(e instanceof ol.layer.Label)).forEach(e=>{e.get("title")==selectedOpt?e.setVisible(!0):e.setVisible(!1)}))},ol.control.LayerMenu.prototype.openMenu=function(){this.getMap().getLayers();this.btn.innerHTML="X",this.container.classList.remove("ol-collapsed"),""==this.menu.innerHTML&&this.renderMenuContents()},ol.control.LayerMenu.prototype.closeMenu=function(){this.getMap().getLayers();this.container.classList.add("ol-collapsed"),this.btn.innerHTML="&#9776;"},ol.control.LayerMenu.prototype.renderMenuContents=function(){var e=document.createElement("div");e.innerHTML="<h5>Tiles</h5>";var t=document.createElement("ul");this.state.layers=map.getLayers(),this.state.layers.forEach(function(e,n,o){if(!(e instanceof ol.layer.Label||void 0==e.get("title"))){var i=e.get("title"),a=e.getVisible(),l=document.createElement("li");l.setAttribute("title",e.get("description"));var r=document.createElement("label"),s=document.createElement("input");s.setAttribute("type","radio"),s.setAttribute("name","tiles"),s.setAttribute("value",i),s.checked=a,r.appendChild(s);var c=document.createElement("span");c.innerHTML=i,r.appendChild(c),l.appendChild(r),t.appendChild(l)}}),e.appendChild(t),this.menu.appendChild(e),ol.events.listen(e,ol.events.EventType.CLICK,this.activateLayer,this);var n=document.createElement("div");n.innerHTML="<h5>Labels</h5>";var o=document.createElement("ul");this.state.layers.forEach(function(e,t){if(e instanceof ol.layer.Label&&void 0!=e.get("title")){var n=e.get("title"),i=e.getVisible(),a=document.createElement("li"),l=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","radio"),r.setAttribute("name","labels"),r.setAttribute("value",n),r.checked=i,l.appendChild(r);var s=document.createElement("span");s.innerHTML=n,l.appendChild(s),a.appendChild(l),o.appendChild(a)}}),n.appendChild(o),this.menu.appendChild(n),ol.events.listen(n,ol.events.EventType.CLICK,this.activateLayerLabel,this)},ol.layer.Label=function(e){var t=e||{};t.style||(t.style=ol.style.labelStyle),void 0===t.updateWhileAnimating&&(t.updateWhileAnimating=!0),void 0===t.updateWhileInteracting&&(t.updateWhileInteracting=!0),ol.layer.Vector.call(this,t)},ol.inherits(ol.layer.Label,ol.layer.Vector),ol.source.Label=function(e){this.labelServerUrl=e.url,e.format=new ol.format.GeoJSON,e.strategy=ol.loadingstrategy.bbox,e.url=this.featureLoader.bind(this),e.updateWhileAnimating=!0,e.updateWhileInteracting=!0,ol.source.Vector.call(this,e)},ol.source.Label.prototype=Object.create(ol.source.Vector.prototype),ol.source.Label.prototype.addFeatureInternal=function(e){var t=e.get("osm");if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var n=e.getGeometry();if(n){var o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.ADDFEATURE,e))}},ol.source.Label.prototype.loadFeatures=function(e,t,n){var o,i,a=this.loadedExtentsRtree_,l=this.strategy_(e,t);for(o=0,i=l.length;o<i;++o){var r=l[o];a.forEachInExtent(r,function(e){return ol.extent.containsExtent(e.extent,r)&&t==e.resolution})||(this.loader_.call(this,r,t,n),a.insert(r,{extent:r.slice(),resolution:t}))}},ol.source.Label.prototype.constructor=ol.source.Label,ol.source.Label.prototype.featureLoader=function(e,t,n){var o=ol.proj.toLonLat(e.slice(0,2)),i=ol.proj.toLonLat(e.slice(2,4)),a=resolutionToMinT(t),l={x_min:o[0],x_max:i[0],y_min:o[1],y_max:i[1],t_min:a};return this.buildQuery(l)},ol.source.Label.prototype.buildQuery=function(e){void 0!==e&&"object"==typeof e||(e={});var t="?",n=0;for(var o in e){n++;var i=o,a=e[o];t+=1==n?i+"="+a:"&"+i+"="+a}return this.labelServerUrl+t};let ICON_CACHE={},TEXT_CACHE={};const ICON_TYPE="icon",TEXT_TYPE="text",ICON_MAPPING={aboriginal:"buddhist.svg",administration:"town_hall.svg",airport:"aerodrome.12.svg",artgallery:"artwork.svg",assortment:"buddhist.svg",atm:"atm.svg",bank:"bank.svg",bar:"bar.svg",bbq:"picnic.svg",beergarden:"biergarten.svg",bicycle_shop:"shop/bicycle.svg",boat:"buddhist.svg",breastfeeding:"buddhist.svg",bus:"bus_stop.12.svg",cafeteria:"shop/coffee.svg",car:"shop/car.svg",car_share:"rental_car.svg",casino:"buddhist.svg",catholicgrave:"grave_yard_christian.svg",church:"christian.svg",cinema:"cinema.svg",clock:"buddhist.svg",coffee:"shop/coffee.svg",communitycentre:"community_centre.svg",congress:"town_hall.svg",court:"courthouse.svg",dance_class:"buddhist.svg",dancinghall:"buddhist.svg",daycare:"buddhist.svg",dentist:"dentist.svg",drinkingfountain:"fountain.svg","e-bike-charging":"charging_station.svg",fast_food:"fast_food.svg",ferry:"ferry.svg",fillingstation:"fuel.svg",firemen:"firestation.svg",firstaid:"buddhist.svg",fountain:"fountain.svg",hospital:"hospital.svg",ice_cream:"shop/ice_cream.svg",library:"library.svg",market:"shop/supermarket.svg",medicalstore:"pharmacy.svg",medicine:"pharmacy.svg",music_classical:"shop/musical_instrument.svg",nursing_home_icon:"buddhist.svg",parking:"parking.svg",parking_bicycle:"bicycle_parking.svg",perfumery:"shop/perfumery.svg",police:"police.svg",postal:"post_office.svg",restaurant:"restaurant.svg",sauna:"buddhist.svg",school:"buddhist.svg",spa:"buddhist.svg",stripclub:"buddhist.svg",taxi:"taxi.svg",telephone:"telephone.svg",theatre:"theatre.svg",toilets:"toilets.svg",tools:"buddhist.svg",trash:"waste_basket.10.svg",undefined:"buddhist.svg",university:"buddhist.svg",veterinary:"veterinary.svg",waiting:"bench.svg",wifi:"buddhist.svg",workoffice:"buddhist.svg"},ICON_URL="https://rawgit.com/gravitystorm/openstreetmap-carto/master/symbols/";function calculateLabelFactor(e){var t=e.get("lbl_fac");return 1.1*parseInt(t)}ol.Label=function(e,t){this.text=e.get("name"),this.feature=e,this.t=e.get("t"),this.factor=e.get("lbl_fac"),this.resolveType(),this.min_t=resolutionToMinT(t)},ol.Label.prototype.resolveType=function(){if(this.text.includes("icon:")){this.type="icon";var e=this.text.replace("icon:","");this.iconUrl=this.getIconURL(e)}else this.type="text"},ol.Label.prototype.render=function(){var e=null;if(this.min_t>this.t)return null;if("icon"==this.type){const t=this.text;void 0===ICON_CACHE[t]?(e=new ol.style.Style({image:new ol.style.Icon({crossOrigin:"anonymous",src:this.iconUrl})}),ICON_CACHE[t]=e):e=ICON_CACHE[t]}else if("text"==this.type){var t=window.debugDrawCirc?this.text+":debug":this.text;if(void 0===TEXT_CACHE[t]){var n=calculateLabelFactor(this.feature),o=n+"px Consolas";this.text.indexOf("\\")>=0&&(this.text=this.text.replace("\\n","\n"));var i=n*this.getMaxLabelLength(this.text)*.26,a=new ol.style.Circle({radius:i,stroke:new ol.style.Stroke({color:"red"})}),l=new ol.style.Text({text:this.text,font:o,stroke:new ol.style.Stroke({color:"#333",width:4}),fill:new ol.style.Fill({color:"#fff"})});e=new ol.style.Style({image:1==window.debugDrawCirc?a:null,text:l}),TEXT_CACHE[t]=e}else e=TEXT_CACHE[t]}return e},ol.Label.prototype.getIconURL=function(e){let t=ICON_MAPPING[void 0];return void 0!==ICON_MAPPING[e]&&(t=ICON_MAPPING[e]),ICON_URL+t},ol.Label.prototype.getMaxLabelLength=function(e){for(var t=e.split("\n"),n=0,o=t.length,i=0;i<o;i++)n<t[i].length&&(n=t[i].length);return n},ol.style.labelStyle=function(e,t){return new ol.Label(e,t).render()};