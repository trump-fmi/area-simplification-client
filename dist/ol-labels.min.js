!function(e){class t{constructor(){this._drawLabelCircles=!1,this._drawLabelBoundaries=!1,this._logProcessingTimes=!1,this._featureUpdateLog=!1,this._labelFactorCoeff=1.1,this._minTFactor=22,this._minTCoeff=1}static get(){return null==this.instance&&(this.instance=new t),this.instance}get drawLabelCircles(){return this._drawLabelCircles}set drawLabelCircles(e){this._drawLabelCircles=e}get drawLabelBoundaries(){return this._drawLabelBoundaries}set drawLabelBoundaries(e){this._drawLabelBoundaries=e}get logProcessingTimes(){return this._logProcessingTimes}set logProcessingTimes(e){this._logProcessingTimes=e}get featureUpdateLog(){return this._featureUpdateLog}set featureUpdateLog(e){this._featureUpdateLog=e}get labelFactorCoeff(){return this._labelFactorCoeff}set labelFactorCoeff(e){this._labelFactorCoeff=e}get minTFactor(){return this._minTFactor}set minTFactor(e){this._minTFactor=e}get minTCoeff(){return this._minTCoeff}set minTCoeff(e){this._minTCoeff=e}}e.UserConfig=t}(ol||(ol={}));const USER_CONFIG=ol.UserConfig.get(),TypedMap=Map;var ol;!function(e){e.resolutionToMinT=function(e){var t=USER_CONFIG.minTCoeff||1,n=USER_CONFIG.minTFactor||22,i=Math.log2(156543.03390625)-Math.log2(e);return i<=3?1e4:t*Math.pow(2,n-(i-1))},e.calculateLabelFactor=function(e){var t=e.get("lbl_fac"),n=USER_CONFIG.labelFactorCoeff||1.1;return parseInt(t)*n}}(ol||(ol={})),function(e){e.control||(e.control={})}(ol||(ol={})),function(e){!function(t){t.DebugMenu=class extends e.control.Control{constructor(e){e=e||{};let t=document.createElement("div");super({element:t,target:e.target}),this.container=t,this.container.className="ol-debug-menu ol-control ol-collapsed",this.menu=document.createElement("div"),this.menu.className="",this.btn=document.createElement("button"),this.btn.className="menu-toggle-button",this.btnIcon={openMenu:">_",closeMenu:"X"},this.btn.innerHTML=this.btnIcon.openMenu,this.btn.addEventListener("click",this.toggleMenu.bind(this)),this.container.appendChild(this.btn),this.container.appendChild(this.menu),this.state={open:!1,demoRunning:!1}}toggleMenu(){!0===this.state.open?this.closeMenu():this.openMenu(),this.state.open=!this.state.open}openMenu(){this.btn.innerHTML=this.btnIcon.closeMenu,this.menu.style.display="",0==this.menu.innerHTML.length&&this.renderMenuContents()}closeMenu(){this.btn.innerHTML=this.btnIcon.openMenu,this.menu.style.display="none"}renderMenuContents(){let e=this,t=this.getMap(),n=t.getView(),i=document.createElement("div");i.style.margin="10px";let a=i.cloneNode(),l=document.createElement("input");l.setAttribute("type","checkbox"),l.checked=USER_CONFIG.drawLabelCircles;let r=document.createElement("label");r.appendChild(l),r.appendChild(document.createTextNode("Draw label circles")),l.addEventListener("change",this.toggleDrawCircles_.bind(this)),a.appendChild(r);let o=document.createElement("input");o.setAttribute("type","checkbox");let s=document.createElement("label");s.style.marginLeft="15px",s.appendChild(o),s.appendChild(document.createTextNode("Draw arc label boundaries")),o.addEventListener("change",this.toggleDrawBoundaries_.bind(this)),a.appendChild(s);let c=document.createElement("input");c.setAttribute("type","checkbox");let d=document.createElement("label");d.style.marginLeft="15px",d.appendChild(c),d.appendChild(document.createTextNode("Log processing times")),c.addEventListener("change",this.toggleLogProcessingTimes_.bind(this)),a.appendChild(d);let u=i.cloneNode(),h=document.createElement("input");h.style.width="300px",h.setAttribute("type","range"),h.setAttribute("id","labelfactorRange"),h.setAttribute("min","0.0"),h.setAttribute("max","3.0"),h.setAttribute("step","0.1"),h.defaultValue=USER_CONFIG.labelFactorCoeff.toString();let m=document.createElement("label");m.id="labelFactorLabel",m.htmlFor="labelfactorRange",m.appendChild(document.createTextNode("Set the coefficient of the labelFactor: (1.1)")),u.appendChild(m),u.appendChild(document.createElement("br")),u.appendChild(h),h.addEventListener("input",this.changeLabelFactor_.bind(this));let g=i.cloneNode(),p=document.createElement("input");p.style.width="300px",p.setAttribute("type","range"),p.setAttribute("id","minTFactorRange"),p.setAttribute("min","0.0"),p.setAttribute("max","100"),p.setAttribute("step","0.1"),p.defaultValue=USER_CONFIG.minTFactor.toString();let y=document.createElement("label");y.id="minTLabel",y.htmlFor="minTFactorRange",y.appendChild(document.createTextNode("Set the offset for the calculation of the min_t: (22)")),p.addEventListener("input",this.changeMinTFactor_.bind(this)),g.appendChild(y),g.appendChild(document.createElement("br")),g.appendChild(p);let b=i.cloneNode(),f=document.createElement("input");f.style.width="300px",f.setAttribute("type","range"),f.setAttribute("id","minTCoeffRange"),f.setAttribute("min","0.0"),f.setAttribute("max","50"),f.setAttribute("step","0.1"),f.defaultValue=USER_CONFIG.minTCoeff.toString();let L=document.createElement("label");L.id="minTCoeffLabel",L.htmlFor="minTCoeffRange",L.appendChild(document.createTextNode("Set the coefficient for the calculation of the min_t: (1.0)")),f.addEventListener("input",this.changeMinTCoeff_.bind(this)),b.appendChild(L),b.appendChild(document.createElement("br")),b.appendChild(f);let _=i.cloneNode(),E=document.createElement("input");E.style.marginLeft="10px",E.style.width="50px",E.setAttribute("type","number"),E.setAttribute("id","zoomLevelDelta"),E.setAttribute("min","0.0"),E.setAttribute("max","10.0"),E.setAttribute("step","0.1"),E.setAttribute("value","1.0");let C=document.createElement("input");C.style.marginTop="10px",C.style.width="600px",C.setAttribute("type","range"),C.setAttribute("id","zoomSliderInput"),C.setAttribute("min",n.getMinZoom().toString()),C.setAttribute("max",n.getMaxZoom().toString()),C.setAttribute("step",E.value),C.defaultValue=t.getView().getZoom().toString();let T=document.createElement("label");T.id="zoomSliderLabel",T.htmlFor="zoomSliderInput",T.appendChild(document.createTextNode("Change the zoom level with defined zoom delta:"));let v=document.createElement("label");v.style.marginLeft="10px",v.style.position="relative",v.style.top="-6px",v.id="zoomLevelLabel",v.htmlFor="zoomLevelLabel",v.appendChild(document.createTextNode("zoom: "+t.getView().getZoom())),E.addEventListener("input",function(){C.setAttribute("step",E.value)}),C.addEventListener("input",function(){let e=parseFloat(C.value);document.getElementById("zoomLevelLabel").innerHTML="zoom: "+C.value,t.getView().setZoom(e)});let w=i.cloneNode(),S=document.createElement("input");S.style.width="600px",S.setAttribute("type","range"),S.setAttribute("id","rotationRange"),S.setAttribute("min","0"),S.setAttribute("max","359"),S.setAttribute("step","1"),S.defaultValue="0";let A=document.createElement("label");A.id="rotationLabel",A.htmlFor="rotationRange",A.innerHTML="Change rotation: (0&deg;)",S.addEventListener("input",this.changeRotation_.bind(this)),w.appendChild(A),w.appendChild(document.createElement("br")),w.appendChild(S),t.on("moveend",function(e){let n=t.getView(),i=Math.round(1e3*n.getZoom())/1e3;document.getElementById("zoomLevelLabel").innerHTML="zoom: "+i,document.getElementById("zoomSliderInput").value=i.toString();let a=Math.round(n.getRotation()/(Math.PI/180));document.getElementById("rotationLabel").innerHTML="Change rotation: ("+a+"&deg;)",document.getElementById("rotationRange").value=a.toString()}),_.appendChild(T),_.appendChild(E),_.appendChild(document.createElement("br")),_.appendChild(C),_.appendChild(v);let M=i.cloneNode(),F=document.createElement("span");F.style.cssFloat="left";let I=document.createElement("label");I.innerHTML="Demo mode: ",F.appendChild(I);let x=document.createElement("button");x.innerHTML="&#9658",x.addEventListener("click",()=>{e.state.demoRunning?(x.innerHTML="&#9658;",e.stopDemoMode()):(x.innerHTML="&#10074;&#10074;",e.startDemoMode()),e.state.demoRunning=!e.state.demoRunning}),F.appendChild(x);let k=document.createElement("span");k.style.cssFloat="right";let R=document.createElement("label");R.innerHTML="Measure render time: ",k.appendChild(R);let N=document.createElement("button");N.innerHTML="&#8986;",N.addEventListener("click",this.measureRenderTime.bind(this,N)),k.appendChild(N),M.appendChild(F),M.appendChild(k);let O=document.createElement("div");O.appendChild(a),O.appendChild(u),O.appendChild(g),O.appendChild(b),O.appendChild(_),O.appendChild(w),O.appendChild(M),this.menu.appendChild(O)}changeRotation_(e){let t=document.getElementById("rotationRange"),n=parseInt(t.value),i=n*(Math.PI/180);this.getMap().getView().setRotation(i),document.getElementById("rotationLabel").innerHTML="Change rotation: ("+n+"&deg;)"}toggleDrawCircles_(e){USER_CONFIG.drawLabelCircles=e.target.checked,this.updateLabelLayers_()}toggleDrawBoundaries_(e){USER_CONFIG.drawLabelBoundaries=e.target.checked,this.updateLabelLayers_()}toggleLogProcessingTimes_(e){USER_CONFIG.logProcessingTimes=e.target.checked}changeLabelFactor_(e){let t=document.getElementById("labelfactorRange");document.getElementById("labelFactorLabel").innerHTML="Set the coefficient of the labelFactor. ("+t.value+")",USER_CONFIG.labelFactorCoeff=parseFloat(t.value),this.updateLabelLayers_()}changeMinTFactor_(e){let t=document.getElementById("minTFactorRange");document.getElementById("minTLabel").innerHTML="Set the offset for the calculation of the min_t. ("+t.value+")",USER_CONFIG.minTFactor=parseFloat(t.value),this.updateLabelLayers_()}changeMinTCoeff_(e){let t=document.getElementById("minTCoeffRange");document.getElementById("minTCoeffLabel").innerHTML="Set the coefficient for the calculation of the min_t. ("+t.value+")",USER_CONFIG.minTCoeff=parseFloat(t.value),this.updateLabelLayers_()}updateLabelLayers_(){this.getMap().getLayers().forEach(function(t){(t instanceof e.layer.Label||t instanceof e.layer.AreaLabel)&&t.getSource().refresh()})}startDemoMode(){let t=this,n=this.getMap().getView(),i=Math.round(6*Math.random())+4,a=3e3*Math.abs(14-i),l=function(){let t=[8,12],n=[48,54],i=Math.random()*(t[1]-t[0]+1)+t[0],a=Math.random()*(n[1]-n[0]+1)+n[0];return e.proj.fromLonLat([i,a])}(),r=Math.random()*(2*Math.PI);n.animate({center:l,duration:2*a,rotation:r},function(){window.setTimeout(function(){t.state.demoRunning&&t.startDemoMode()},1)}),n.animate({zoom:i,duration:a},{zoom:14,duration:a})}stopDemoMode(){this.getMap().getView().cancelAnimations()}measureRenderTime(t){let n=void 0!==t;n&&t.classList.add("rotate"),window.setTimeout(()=>{let i=this.getMap(),a=[],l=0;i.getLayers().getArray().filter(t=>t instanceof e.layer.Area).map(e=>e).filter(e=>e.isCurrentlyDisplayed()).forEach(e=>{let t=e.get("title"),n=e.getSource(),r=n.getFeatures();n.clear(),n.refresh(),i.renderSync();let o=performance.now();n.addFeatures(r),n.refresh();let s=performance.now()-o;a.push(t+": "+Math.round(s)+" ms"),l+=s}),n&&t.classList.remove("rotate"),window.setTimeout(()=>{alert("Measured rendering times:\n\n"+a.join("\n")+"\n\nSum: "+Math.round(l)+" ms")},100)},100)}}}(e.control||(e.control={}))}(ol||(ol={})),function(e){!function(t){t.LayerMenu=class extends e.control.Control{constructor(e){e=e||{};let t=document.createElement("div");super({element:t,target:e.target}),this.container=t,this.menu=document.createElement("div"),this.menu.className="layer-menu",this.btn=document.createElement("button"),this.btn.innerHTML="&#9776;";let n=this;this.btn.addEventListener("click",function(){n.toggleMenu()}),t.className="ol-layer-menu ol-control ol-collapsed",t.appendChild(this.menu),t.appendChild(this.btn),this.menuOpened=!1,this.allLayers=[]}renderMenuContents(){this.allLayers=this.getMap().getLayers().getArray();let t=document.createElement("div");t.innerHTML="<h5>Tiles</h5>";let n=document.createElement("ul"),i=document.createElement("li"),a=document.createElement("input");a.setAttribute("type","checkbox"),a.checked=!0;let l=document.createElement("span");l.innerHTML="Show tiles";let r=document.createElement("label");r.appendChild(a),r.appendChild(l),a.addEventListener("change",this.toggleLayersByType.bind(this,e.layer.Tile)),i.appendChild(r),n.appendChild(i),this.allLayers.filter(t=>t instanceof e.layer.Tile).forEach(e=>{let t=e.get("title"),i=e.getVisible(),a=document.createElement("li"),l=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","radio"),r.setAttribute("name","tiles"),r.setAttribute("value",t),r.checked=i,l.appendChild(r);let o=document.createElement("span");o.innerHTML=t,l.appendChild(o),a.appendChild(l),n.appendChild(a);let s=this.activateLayerXOR.bind(this,e);r.addEventListener("click",s)}),t.appendChild(n),this.menu.appendChild(t);let o=document.createElement("div");o.innerHTML="<h5>Areas</h5>";let s=document.createElement("ul"),c=this.allLayers.filter(t=>t instanceof e.layer.AreaLabel),d=document.createElement("li"),u=document.createElement("input");u.setAttribute("type","checkbox"),u.checked=!0;let h=document.createElement("span");h.innerHTML="Area labels";let m=document.createElement("label");m.appendChild(u),m.appendChild(h),u.addEventListener("change",this._toggleLayersDisplayIntention.bind(this,c)),d.appendChild(m);let g=document.createElement("span");g.style.marginLeft="5px",g.style.cssFloat="right";let p=document.createElement("input");p.style.width="60px",p.style.height="18px",p.setAttribute("title","Opacity: 100%"),p.setAttribute("type","range"),p.setAttribute("min","0.0"),p.setAttribute("max","1.0"),p.setAttribute("step","0.01"),p.defaultValue="1.0";let y=this._updateLayersOpacity.bind(this,c,p);p.addEventListener("input",y),g.appendChild(p),d.appendChild(g);let b=document.createElement("div");b.style.clear="both",d.appendChild(b),s.appendChild(d),this.allLayers.filter(t=>t instanceof e.layer.Area).forEach(e=>{let t=e;if(t.get("parent"))return;let n=[t],i=t.get("children")||[];n.push(...i);let a=document.createElement("li"),l=document.createElement("label"),r=document.createElement("input"),o=document.createElement("span");r.setAttribute("type","checkbox"),r.checked=t.displayIntention,o.innerHTML=e.get("title"),r.addEventListener("click",this._toggleLayersDisplayIntention.bind(this,n));let c=document.createElement("span");c.style.marginLeft="5px",c.style.cssFloat="right";let d=document.createElement("input");d.style.width="60px",d.style.height="18px",d.setAttribute("title","Opacity: 100%"),d.setAttribute("type","range"),d.setAttribute("min","0.0"),d.setAttribute("max","1.0"),d.setAttribute("step","0.01"),d.defaultValue="1.0";let u=this._updateLayersOpacity.bind(this,n,d);d.addEventListener("input",u),c.appendChild(d);let h=document.createElement("div");h.style.clear="both",l.appendChild(r),l.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(h),s.appendChild(a)}),o.appendChild(s),this.menu.appendChild(o);let f=document.createElement("div");f.innerHTML="<h5>Labels</h5>";let L=document.createElement("ul"),_=document.createElement("li"),E=document.createElement("input");E.setAttribute("type","checkbox"),E.checked=!0;let C=document.createElement("span");C.innerHTML="Show labels";let T=document.createElement("label");T.appendChild(E),T.appendChild(C),E.addEventListener("change",this.toggleLayersByType.bind(this,e.layer.Label)),_.appendChild(T),L.appendChild(_),this.allLayers.filter(t=>t instanceof e.layer.Label).forEach(e=>{let t=e.get("title"),n=e.getVisible(),i=document.createElement("li"),a=document.createElement("label"),l=document.createElement("input");l.setAttribute("type","radio"),l.setAttribute("name","labels"),l.setAttribute("value",t),l.checked=n,a.appendChild(l);let r=document.createElement("span");r.innerHTML=t,a.appendChild(r),i.appendChild(a),L.appendChild(i);let o=this.activateLayerXOR.bind(this,e);l.addEventListener("click",o)}),f.appendChild(L),this.menu.appendChild(f)}toggleMenu(){this.menuOpened?this.closeMenu():this.openMenu(),this.menuOpened=!this.menuOpened}activateLayerXOR(e){let t=e.constructor;this.allLayers.filter(e=>e instanceof t).forEach(t=>t.setVisible(e==t)),console.log(this.allLayers)}openMenu(){this.btn.innerHTML="X",this.container.classList.remove("ol-collapsed"),""==this.menu.innerHTML&&this.renderMenuContents()}closeMenu(){this.container.classList.add("ol-collapsed"),this.btn.innerHTML="&#9776;"}toggleLayersByType(e){this.allLayers.filter(t=>t instanceof e).forEach(e=>{let t=e.getOpacity()<1?1:0;e.setOpacity(t)})}_toggleLayersDisplayIntention(e){e.forEach(e=>e.toggleDisplayIntention())}_updateLayersOpacity(e,t){let n=parseFloat(t.value);e.forEach(e=>e.setOpacity(n));let i=Math.round(100*n);t.setAttribute("title","Opacity: "+i+"%")}}}(e.control||(e.control={}))}(ol||(ol={})),function(e){!function(t){const n=64;t.ArcLineString=class extends e.geom.LineString{constructor(e,t,n,i,a){super([],a),this._circleCentre=e,this._radius=t,this._startAngle=n,this._endAngle=i,this.generateVertices()}generateVertices(){const t=n/(2*Math.PI);let i=new e.geom.Circle(this._circleCentre,this._radius),a=e.geom.Polygon.fromCircle(i,n,0).getCoordinates()[0],l=0,r=0;l=this._startAngle>=0?Math.abs(this._startAngle)*t:n-this._startAngle*t,r=this._endAngle>=0?this._endAngle*t:n-Math.abs(this._endAngle)*t,l=Math.floor(l),r=Math.floor(r);let o=[],s=!1;for(let e=0;e<=2*(n-1);e++){let t=e%n;if(e===l&&(s=!0),s&&o.push(a[t]),t===r&&s)break}let c=this.getLayout();this.setCoordinates(o,c)}get circleCentre(){return this._circleCentre}set circleCentre(e){this._circleCentre=e}get radius(){return this._radius}set radius(e){this._radius=e}get startAngle(){return this._startAngle}set startAngle(e){this._startAngle=e}get endAngle(){return this._endAngle}set endAngle(e){this._endAngle=e}}}(e.geom||(e.geom={}))}(ol||(ol={})),function(e){!function(t){t.ZoomAware=class extends e.layer.Vector{constructor(e,t,n,i){super(e),this._minZoom=0,this._maxZoom=Number.POSITIVE_INFINITY,this._displayIntention=!0,this.map=t,void 0!==n&&(this._minZoom=n),void 0!==i&&(this._maxZoom=i);let a=this.updateVisibility.bind(this);this.map.on("moveend",a)}toggleDisplayIntention(){this._displayIntention=!this._displayIntention,this.updateVisibility()}isVisibleAtZoomLevel(e){return e>=this.minZoom&&e<this.maxZoom&&this._displayIntention}setVisible(e){this.displayIntention=e}isCurrentlyDisplayed(){let e=this.map.getView().getZoom();return this.isVisibleAtZoomLevel(e)}get displayIntention(){return this._displayIntention}set displayIntention(e){this._displayIntention=e,this.updateVisibility()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom=e,this.updateVisibility()}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom=e}updateVisibility(){let e=this.map.getView().getZoom(),t=this.isVisibleAtZoomLevel(e);super.setVisible(t)}}}(e.layer||(e.layer={}))}(ol||(ol={})),function(e){!function(t){const n=1e3;t.Area=class extends t.ZoomAware{constructor(t,i,a){t.style=t.style||e.style.areaStyleFunction(i),t.updateWhileAnimating=t.updateWhileAnimating||!1,t.updateWhileInteracting=t.updateWhileInteracting||!1,t.renderMode=t.renderMode||"image",t.declutter=!0,super(t,a,i.zoom_min,i.zoom_max),this.areaType=i,this.areaType.labels?(this._hasLabels=!0,this.labelLayer=new e.layer.AreaLabel({source:new e.source.Vector,zIndex:this.areaType.z_index+n},i.labels,a),a.addLayer(this.labelLayer)):this._hasLabels=!1,this.highlightLocation=null;let l=this;this.getSource()instanceof e.source.Area&&this.getSource().addFeatureListener(function(e){l.checkFeatureForHighlight(e),l.createLabelForFeature(e)})}get hasLabels(){return this._hasLabels}highlightFeaturesAt(e){if(!this.areaType.search_highlight)return;this.highlightLocation=e;let t=this;this.getSource().getFeatures().forEach(function(e){t.checkFeatureForHighlight(e)})}createLabelForFeature(e){this.hasLabels&&this.labelLayer.addLabelForFeature(e)}checkFeatureForHighlight(e){null!=this.highlightLocation&&null!=e&&(e.getGeometry().intersectsCoordinate(this.highlightLocation)?e.set("highlight",!0):e.unset("highlight"))}}}(e.layer||(e.layer={}))}(ol||(ol={})),function(e){!function(t){t.AreaLabel=class extends t.ZoomAware{constructor(t,n,i){t.style=t.style||e.style.arcLabelStyleFunction,t.updateWhileAnimating=t.updateWhileAnimating||!1,t.updateWhileInteracting=t.updateWhileInteracting||!1,t.renderMode=t.renderMode||"vector",t.source=t.source||new source.Vector,t.declutter=!1,super(t,i,n.zoom_min,n.zoom_max),this.labelOptions=n}addLabelForFeature(t){let n=t.get("label")||"";if((n=n.trim()).length<2)return;let i=t.get("label_center"),a=t.get("inner_radius"),l=t.get("outer_radius"),r=t.get("start_angle"),o=t.get("end_angle"),s=t.getId(),c=(a+l)/2,d=new e.geom.ArcLineString(i,c,r,o),u=new e.Feature(d);u.set("arc_height",l-a),u.set("text",n),u.setId(s+"_label_guide");let h=new e.geom.ArcLineString(i,a,r,o),m=new e.geom.ArcLineString(i,l,r,o),g=new e.geom.LineString([i,m.getFirstCoordinate()]),p=new e.geom.LineString([i,m.getLastCoordinate()]),y=new e.geom.GeometryCollection([h,m,g,p]),b=new e.Feature(y);b.setId(s+"_label_boundary"),this.getSource().addFeatures([u,b])}}}(e.layer||(e.layer={}))}(ol||(ol={})),function(e){!function(t){t.Label=class extends e.layer.Vector{constructor(t){t.style||(t.style=e.style.labelStyleFunction),void 0===t.updateWhileAnimating&&(t.updateWhileAnimating=!0),void 0===t.updateWhileInteracting&&(t.updateWhileInteracting=!0),super(t)}}}(e.layer||(e.layer={}))}(ol||(ol={})),function(e){!function(t){class n extends t.Vector{constructor(t,i,a){let l=t.url.toString(),r=n.createFeatureLoader(l,i);t.format=new e.format.GeoJSON;let o=0;t.strategy=function(e,t){let n=s.map.getView().getZoom();return Math.abs(o-n)>.2&&(s.loadedExtentsRtree_.clear(),o=n),[e]},t.url=r,super(t);let s=this;this.areaServerUrl=l,this.featureLoader=r,this.featureListeners=new Array,this.map=i,this.areaTypeName=a}addFeatureListener(e){this.featureListeners.push(e)}addFeatures(e){let t=performance.now(),n=this.processNewFeature.bind(this);if(e.forEach(n),USER_CONFIG.logProcessingTimes){let n=Math.round(performance.now()-t);console.log("["+this.areaTypeName+"] Processed "+e.length+" features in "+n+" ms")}}processNewFeature(e){this.notifyFeatureListeners(e);let t=this.getFeatureById(e.getId());null!=t?e.get("zoom")!=t.get("zoom")&&(super.removeFeature(t),super.addFeature(e),USER_CONFIG.featureUpdateLog&&console.log("["+this.areaTypeName+'] Updated feature "'+e.getId()+'"')):super.addFeature(e)}static createFeatureLoader(t,i){return(a,l,r)=>{let o=e.proj.toLonLat(a.slice(0,2)),s=e.proj.toLonLat(a.slice(2,4)),c=i.getView().getZoom(),d={x_min:o[0],x_max:s[0],y_min:o[1],y_max:s[1],zoom:c};return n.buildQuery(t,d)}}static buildQuery(e,t){"object"!=typeof t&&(t={});let n="?",i=!0;for(let e in t){if(!t.hasOwnProperty(e))continue;let a=e,l=t[e];n+=i?a+"="+l:"&"+a+"="+l,i=!1}return e+n}notifyFeatureListeners(e){this.featureListeners.forEach(function(t){t(e)})}}t.Area=n}(e.source||(e.source={}))}(ol||(ol={})),function(e){!function(t){class n extends t.Vector{constructor(t){var i=t.url.toString(),a=n.createFeatureLoader(i);t.format=new e.format.GeoJSON,t.strategy=e.loadingstrategy.bbox,t.url=a,super(t),this.labelServerUrl=i,this.featureLoader=a}static createFeatureLoader(t){return(i,a,l)=>{var r=e.proj.toLonLat(i.slice(0,2)),o=e.proj.toLonLat(i.slice(2,4)),s=e.resolutionToMinT(a),c={x_min:r[0],x_max:o[0],y_min:r[1],y_max:o[1],t_min:s};return n.buildQuery(t,c)}}static buildQuery(e,t){"object"!=typeof t&&(t={});var n="?",i=!0;for(var a in t)if(t.hasOwnProperty(a)){var l=a,r=t[a];n+=i?l+"="+r:"&"+l+"="+r,i=!1}return e+n}}t.Label=n}(e.source||(e.source={}))}(ol||(ol={})),function(e){!function(t){const n=20,i=e=>`bold ${e}px "Lucida Console", "Courier", "Arial Black"`,a=new e.style.Style({text:new e.style.Text({font:"",placement:"line",stroke:new e.style.Stroke({color:"black",width:2}),fill:new e.style.Fill({color:"white"}),rotateWithView:!1,text:"",textAlign:"center"})}),l=new e.style.Style({stroke:new e.style.Stroke({color:"darkgreen",width:2})}),r=new e.style.Style({});t.arcLabelStyleFunction=function(t,o){let s=t.getGeometry();if(s instanceof e.geom.GeometryCollection)return USER_CONFIG.drawLabelBoundaries?l:r;if(!(s instanceof e.geom.ArcLineString))return r;let c=t.get("text"),d=t.get("arc_height"),u=a.getText();if(u.setText(c),d){let e=Math.floor(d/o);if(e<n)return r;u.setFont(i(e))}return a}}(e.style||(e.style={}))}(ol||(ol={})),function(e){!function(t){const n=new e.style.Style({stroke:new e.style.Stroke({color:"#a34905",width:3})}),i=new e.style.Style({fill:new e.style.Fill({color:"rgba(44, 2, 196, 0.8)"})}),a=new e.style.Style({stroke:new e.style.Stroke({color:"rgba(44, 2, 196, 0.8)",width:5})});t.STYLE_TOWNS=function(e,t){return n},t.STYLE_WOODLAND=new e.style.Style({stroke:new e.style.Stroke({color:"#248c26",width:1}),fill:new e.style.Fill({color:"rgba(41, 163, 43, 0.6)"})}),t.STYLE_FARMLAND=new e.style.Style({stroke:new e.style.Stroke({color:"#b5b540",width:1}),fill:new e.style.Fill({color:"rgba(204, 204, 110, 0.6)"})}),t.STYLE_WATER=function(e,t){let n=e.getGeometry().getType();if("LineString"===n||"MultiLineString"===n){const n=(e.get("width")||18)/t;return a.getStroke().setWidth(n),a}return i},t.STYLE_COMMERCIAL=new e.style.Style({fill:new e.style.Fill({color:"rgb(238, 206, 209)"})}),t.STYLE_MILITARY=new e.style.Style({fill:new e.style.Fill({color:"rgba(209, 10, 19, 0.6)"})}),t.STYLE_RESIDENTIAL=new e.style.Style({fill:new e.style.Fill({color:"rgb(218, 218, 218)"})}),t.STYLE_BUILDINGS=new e.style.Style({stroke:new e.style.Stroke({color:"#69523f",width:1}),fill:new e.style.Fill({color:"rgba(163, 130, 102, 1)"})}),t.STYLE_MOTORWAYS=new e.style.Style({stroke:new e.style.Stroke({color:"#E990A0",width:7})}),t.STYLE_MAIN_STREETS=new e.style.Style({stroke:new e.style.Stroke({color:"#F6FABB",width:5})}),t.STYLE_BYSTREETS=new e.style.Style({stroke:new e.style.Stroke({color:"#FFFFFF",width:4})}),t.STYLE_RAILWAYS=[new e.style.Style({stroke:new e.style.Stroke({color:[0,0,0,1],width:4})}),new e.style.Style({stroke:new e.style.Stroke({color:[255,255,255,1],width:4,lineDash:[10,20,10,20]})})],t.STYLE_OTHER_HIGHLIGHT=new e.style.Style({stroke:new e.style.Stroke({color:"red",width:5}),zIndex:999999}),t.STYLE_OTHER_POLYGON_POINTS=new e.style.Style({image:new e.style.Circle({radius:5,fill:new e.style.Fill({color:"orange"})}),geometry:function(t){var n=t.getGeometry();if(n instanceof e.geom.Polygon){var i=n;return new e.geom.MultiPoint(i.getCoordinates()[0])}if(n instanceof e.geom.MultiPolygon){for(var a=n.getCoordinates(),l=[],r=0;r<a.length;r++)for(var o=0;o<a[r][0].length;o++)l.push(a[r][0][o]);return new e.geom.MultiPoint(l)}}})}(e.style||(e.style={}))}(ol||(ol={})),function(e){!function(t){const n=new TypedMap([["districts",t.STYLE_TOWNS],["towns",t.STYLE_TOWNS],["villages",t.STYLE_TOWNS],["woodland",t.STYLE_WOODLAND],["farmland",t.STYLE_FARMLAND],["water",t.STYLE_WATER],["commercial",t.STYLE_COMMERCIAL],["military",t.STYLE_MILITARY],["residential",t.STYLE_RESIDENTIAL],["buildings",t.STYLE_BUILDINGS],["motorways",t.STYLE_MOTORWAYS],["main_streets",t.STYLE_MAIN_STREETS],["bystreets",t.STYLE_BYSTREETS],["railways",t.STYLE_RAILWAYS]]);t.areaStyleFunction=function(i){const a=n.get(i.resource)||[];return(n,i)=>{let l=[];if(a instanceof e.style.Style)l.push(a);else if(a instanceof Array)a.forEach(e=>l.push(e));else if("function"==typeof a){let t=a(n,i);t instanceof e.style.Style?l.push(t):t instanceof Array&&t.forEach(e=>l.push(e))}return n.get("highlight")?l.concat([t.STYLE_OTHER_HIGHLIGHT]):l}}}(e.style||(e.style={}))}(ol||(ol={})),function(e){let t;!function(e){e[e.ICON=0]="ICON",e[e.TEXT=1]="TEXT"}(t||(t={}));const n=new TypedMap([["aboriginal","buddhist.svg"],["administration","town_hall.svg"],["airport","aerodrome.12.svg"],["artgallery","artwork.svg"],["assortment","buddhist.svg"],["atm","atm.svg"],["bank","bank.svg"],["bar","bar.svg"],["bbq","picnic.svg"],["beergarden","biergarten.svg"],["bicycle_shop","shop/bicycle.svg"],["boat","buddhist.svg"],["breastfeeding","buddhist.svg"],["bus","bus_stop.12.svg"],["cafeteria","shop/coffee.svg"],["car","shop/car.svg"],["car_share","rental_car.svg"],["casino","buddhist.svg"],["catholicgrave","grave_yard_christian.svg"],["church","christian.svg"],["cinema","cinema.svg"],["clock","buddhist.svg"],["coffee","shop/coffee.svg"],["communitycentre","community_centre.svg"],["congress","town_hall.svg"],["court","courthouse.svg"],["dance_class","buddhist.svg"],["dancinghall","buddhist.svg"],["daycare","buddhist.svg"],["dentist","dentist.svg"],["drinkingfountain","fountain.svg"],["e-bike-charging","charging_station.svg"],["fast_food","fast_food.svg"],["ferry","ferry.svg"],["fillingstation","fuel.svg"],["firemen","firestation.svg"],["firstaid","buddhist.svg"],["fountain","fountain.svg"],["hospital","hospital.svg"],["ice_cream","shop/ice_cream.svg"],["library","library.svg"],["market","shop/supermarket.svg"],["medicalstore","pharmacy.svg"],["medicine","pharmacy.svg"],["music_classical","shop/musical_instrument.svg"],["nursing_home_icon","buddhist.svg"],["parking","parking.svg"],["parking_bicycle","bicycle_parking.svg"],["perfumery","shop/perfumery.svg"],["police","police.svg"],["postal","post_office.svg"],["restaurant","restaurant.svg"],["sauna","buddhist.svg"],["school","buddhist.svg"],["spa","buddhist.svg"],["stripclub","buddhist.svg"],["taxi","taxi.svg"],["telephone","telephone.svg"],["theatre","theatre.svg"],["toilets","toilets.svg"],["tools","buddhist.svg"],["trash","waste_basket.10.svg"],["undefined","buddhist.svg"],["university","buddhist.svg"],["veterinary","veterinary.svg"],["waiting","bench.svg"],["wifi","buddhist.svg"],["workoffice","buddhist.svg"]]),i="https://rawgit.com/gravitystorm/openstreetmap-carto/master/symbols/";class a{constructor(t,n){this.feature=t,this.text=t.get("name"),this.t=t.get("t"),this.factor=t.get("lbl_fac"),this.resolveType(),this.min_t=e.resolutionToMinT(n)}resolveType(){if(this.text.includes("icon:")){this.type=t.ICON;var e=this.text.replace("icon:","");this.iconUrl=a.getIconURL(e)}else this.type=t.TEXT}render(){var n=null;if(this.min_t>this.t)return null;if(this.type==t.ICON){const t=this.text;void 0===a.iconCache.get(t)?(n=new e.style.Style({image:new e.style.Icon({crossOrigin:"anonymous",src:this.iconUrl})}),a.iconCache.set(t,n)):n=a.iconCache.get(t)}else if(this.type==t.TEXT){var i=USER_CONFIG.drawLabelCircles?this.text+":debug":this.text;if(void 0===a.textCache.get(i)){var l=e.calculateLabelFactor(this.feature),r=l+"px Consolas";this.text.indexOf("\\")>=0&&(this.text=this.text.replace("\\n","\n"));var o=l*a.getMaxLabelLength(this.text)*.26,s=new e.style.Circle({radius:o,stroke:new e.style.Stroke({color:"red"})}),c=new e.style.Text({text:this.text,font:r,stroke:new e.style.Stroke({color:"#333",width:4}),fill:new e.style.Fill({color:"#fff"})});n=new e.style.Style({image:1==USER_CONFIG.drawLabelCircles?s:null,text:c}),a.textCache.set(i,n)}else n=a.textCache.get(i)}return n}static getIconURL(e){let t=n.get("undefined");return void 0!==n.get(e)&&(t=n.get(e)),i+t}static getMaxLabelLength(e){for(var t=e.split("\n"),n=0,i=t.length,a=0;a<i;a++)n<t[a].length&&(n=t[a].length);return n}}a.iconCache=new TypedMap,a.textCache=new TypedMap,e.Label=a}(ol||(ol={})),function(e){!function(t){t.labelStyleFunction=function(t,n){return new e.Label(t,n).render()}}(e.style||(e.style={}))}(ol||(ol={}));