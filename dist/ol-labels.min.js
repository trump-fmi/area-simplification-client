function calculateLabelFactor(e){var t=e.get("lbl_fac");return 1.1*parseInt(t)}function resolutionToMinT(e){var t=Math.log2(156543.03390625)-Math.log2(e);return t<=3?1e4:Math.pow(2,9-(t-1))}ol.control.defaults=function(e){var t=e||{},n=new ol.Collection;return(void 0===t.zoom||t.zoom)&&n.push(new ol.control.Zoom(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&n.push(new ol.control.Rotate(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&n.push(new ol.control.Attribution(t.attributionOptions)),n},ol.control.LabelDebug=function(e){var t=e||{};this.state={open:!1,isDemoModeRunning:!1},this.btn=document.createElement("button"),this.btn.className="menu-toggle-button",this.buttonIcon={openMenu:">_",closeMenu:"X"},this.btn.innerHTML=this.buttonIcon.openMenu,ol.events.listen(this.btn,ol.events.EventType.CLICK,this.toggleMenu,this),this.container=document.createElement("div"),this.container.className="ol-label-debug ol-control ol-collapsed",this.menu=document.createElement("div"),this.menu.className="",this.container.appendChild(this.btn),this.container.appendChild(this.menu),ol.control.Control.call(this,{element:this.container,target:t.target})},ol.inherits(ol.control.LabelDebug,ol.control.Control),ol.control.LabelDebug.prototype.toggleMenu=function(){!0===this.state.open?this.closeMenu():this.openMenu(),this.state.open=!this.state.open},ol.control.LabelDebug.prototype.openMenu=function(){this.btn.innerHTML=this.buttonIcon.closeMenu,this.menu.style.display="",0==this.menu.innerHTML.length&&this.renderMenuContents()},ol.control.LabelDebug.prototype.closeMenu=function(){this.btn.innerHTML=this.buttonIcon.openMenu,this.menu.style.display="none"},ol.control.LabelDebug.prototype.renderMenuContents=function(){function e(){L.setAttribute("step",y.value)}function t(){document.getElementById("zoomLevelLabel").innerHTML="zoom: "+L.value,o.getView().setZoom(L.value)}function n(){_.state.isDemoModeRunning?(E.innerHTML="&#9658;",_.stopDemoMode_()):(E.innerHTML="&#10074;&#10074;",_.startDemoMode_()),_.state.isDemoModeRunning=!_.state.isDemoModeRunning}var o=this.getMap(),i={width:"300px"},a=document.createElement("div");Object.assign(a.style,{margin:"10px"});var l=a.cloneNode(),r=document.createElement("input");r.setAttribute("type","checkbox"),r.id="drawCirclesCheckbox";var s=document.createElement("label");s.htmlFor="drawCirclesCheckbox",s.appendChild(r),s.appendChild(document.createTextNode("Draw circles around the labels.")),l.appendChild(s),ol.events.listen(r,ol.events.EventType.CHANGE,ol.control.LabelDebug.prototype.toggleDrawCircles_.bind(this)),window.debugDrawCirc=!1;var c=a.cloneNode(),u=document.createElement("input");Object.assign(u.style,i),u.setAttribute("type","range"),u.setAttribute("id","labelfactorRange"),u.setAttribute("min","0.0"),u.setAttribute("max","3.0"),u.setAttribute("step","0.1"),u.defaultValue="1.1";var d=document.createElement("label");d.id="sliderLabel",d.htmlFor="labelfactorRange",d.appendChild(document.createTextNode("Set the coefficient of the labelFactor. (1.1)")),c.appendChild(d),c.appendChild(document.createElement("br")),c.appendChild(u),ol.events.listen(u,"input",ol.control.LabelDebug.prototype.changeLabelFactor_.bind(this)),window.labelFacCoeff=1.1;var h=a.cloneNode(),p=document.createElement("input");Object.assign(p.style,i),p.setAttribute("type","range"),p.setAttribute("id","minTFactorRange"),p.setAttribute("min","0.0"),p.setAttribute("max","20"),p.setAttribute("step","0.1"),p.defaultValue="9";var m=document.createElement("label");m.id="minTLabel",m.htmlFor="minTFactorRange",m.appendChild(document.createTextNode("Set the offset for the calculation of the min_t. (9)")),ol.events.listen(p,"input",ol.control.LabelDebug.prototype.changeMinTFactor_.bind(this)),h.appendChild(m),h.appendChild(document.createElement("br")),h.appendChild(p),window.minTFac=9;var g=a.cloneNode(),b=document.createElement("input");Object.assign(b.style,i),b.setAttribute("type","range"),b.setAttribute("id","minTCoeffRange"),b.setAttribute("min","0.0"),b.setAttribute("max","5"),b.setAttribute("step","0.1"),b.defaultValue="1.0";var v=document.createElement("label");v.id="minTCoeffLabel",v.htmlFor="minTCoeffRange",v.appendChild(document.createTextNode("Set the coefficient for the calculation of the min_t. (1.0)")),ol.events.listen(b,"input",ol.control.LabelDebug.prototype.changeMinTCoeff_.bind(this)),g.appendChild(v),g.appendChild(document.createElement("br")),g.appendChild(b),window.minTCoeff=1;var f=a.cloneNode(),y=document.createElement("input");Object.assign(y.style,{"margin-left":"10px",width:"50px"}),y.setAttribute("type","number"),y.setAttribute("id","zoomLevelDelta"),y.setAttribute("min","0.0"),y.setAttribute("max","10.0"),y.setAttribute("step","0.1"),y.setAttribute("value","1.0");var L=document.createElement("input");Object.assign(L.style,{width:"600px","margin-top":"10px"}),L.setAttribute("type","range"),L.setAttribute("id","zoomSliderInput"),L.setAttribute("min",0),L.setAttribute("max",28),L.setAttribute("step",y.value),L.defaultValue=o.getView().getZoom();var C=document.createElement("label");C.id="zoomSliderLabel",C.htmlFor="zoomSliderInput",C.appendChild(document.createTextNode("Use the slider to change the zoom level with the defined zoom delta:"));var M=document.createElement("label");Object.assign(M.style,{"margin-left":"10px",position:"relative",top:"-6px"}),M.id="zoomLevelLabel",M.htmlFor="zoomLevelLabel",M.appendChild(document.createTextNode("zoom: "+o.getView().getZoom())),ol.events.listen(y,"input",e),ol.events.listen(L,"input",t),o.on("moveend",function(e){var t=o.getView().getZoom();t=Math.round(1e3*t)/1e3,document.getElementById("zoomLevelLabel").innerHTML="zoom: "+t,document.getElementById("zoomSliderInput").value=t}),f.appendChild(C),f.appendChild(y),f.appendChild(document.createElement("br")),f.appendChild(L),f.appendChild(M);var T=a.cloneNode(),E=document.createElement("button");E.className="demo-mode-button",E.id="demoModeControlBtn",E.innerHTML="&#9658";var w=document.createElement("label");w.id="demoModeControlLabel",w.htmlFor="demoModeControlBtn",w.innerHTML="Demo mode: ",ol.events.listen(E,ol.events.EventType.CLICK,n);var _=this;T.appendChild(w),T.appendChild(E);var x=document.createElement("div");x.appendChild(l),x.appendChild(c),x.appendChild(h),x.appendChild(g),x.appendChild(f),x.appendChild(T),this.menu.appendChild(x),resolutionToMinT=this.resolutionToMinT,calculateLabelFactor=this.calculateLabelFactor},ol.control.LabelDebug.prototype.toggleDrawCircles_=function(e){e.preventDefault(),window.debugDrawCirc=document.getElementById("drawCirclesCheckbox").checked,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.changeLabelFactor_=function(e){e.preventDefault();var t=document.getElementById("labelfactorRange");document.getElementById("sliderLabel").innerHTML="Set the coefficient of the labelFactor. ("+t.value+")",window.labelFacCoeff=t.value,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.changeMinTFactor_=function(e){e.preventDefault();var t=document.getElementById("minTFactorRange");document.getElementById("minTLabel").innerHTML="Set the offset for the calculation of the min_t. ("+t.value+")",window.minTFac=t.value,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.changeMinTCoeff_=function(e){e.preventDefault();var t=document.getElementById("minTCoeffRange");document.getElementById("minTCoeffLabel").innerHTML="Set the coefficient for the calculation of the min_t. ("+t.value+")",window.minTCoeff=t.value,this.updateLabelLayer_()},ol.control.LabelDebug.prototype.updateLabelLayer_=function(){this.getMap().getLayers().forEach(function(e){e instanceof ol.layer.Label&&e.getSource().refresh()})},ol.control.LabelDebug.prototype.resolutionToMinT=function(e){var t=Math.log2(156543.03390625)-Math.log2(e);return t<=3?1e4:window.minTCoeff*Math.pow(2,window.minTFac-(t-1))},ol.control.LabelDebug.prototype.calculateLabelFactor=function(e){var t=e.get("lbl_fac");return parseInt(t)*window.labelFacCoeff},ol.control.LabelDebug.prototype.startDemoMode_=function(){function e(){setTimeout(function(){t.state.isDemoModeRunning&&t.startDemoMode_()},1)}var t=this,n=this.getMap().getView(),o=(n.getRotation(),n.getCenter()),i=3e3,a=function(){return Math.round(6*Math.random())+4}();i*=Math.abs(14-a);var l=function(){var e=[8,12],t=[48,54],n=Math.random()*(e[1]-e[0]+1)+e[0],o=Math.random()*(t[1]-t[0]+1)+t[0];return ol.proj.fromLonLat([n,o])}(),r=(Math.round(100*new ol.geom.LineString([o,l]).getLength()),function(){return Math.random()*(2*Math.PI)}());n.animate({center:l,duration:2*i,rotation:r},e),n.animate({zoom:a,duration:i},{zoom:14,duration:i})},ol.control.LabelDebug.prototype.stopDemoMode_=function(){var e=this.getMap().getView();e.setResolution(e.getResolution())},ol.control.LayerMenu=function(e){var t=e||{};this.state={open:!1,layers:[]},this.btn=document.createElement("button"),this.btn.innerHTML="&#9776;";ol.events.listen(this.btn,ol.events.EventType.CLICK,this.toggleMenu,this),this.container=document.createElement("div"),this.container.className="ol-layer-menu ol-control ol-collapsed",this.menu=document.createElement("div"),this.menu.className="layer-menu",this.container.appendChild(this.menu),this.container.appendChild(this.btn),ol.control.Control.call(this,{element:this.container,target:t.target})},ol.inherits(ol.control.LayerMenu,ol.control.Control),ol.control.LayerMenu.prototype.toggleMenu=function(){!0===this.state.open?this.closeMenu():this.openMenu(),this.state.open=!this.state.open},ol.control.LayerMenu.prototype.activateLayerLabel=function(e){void 0!=e.target.value&&(selectedOpt=e.target.value,checked=e.target.checked,this.state.layers.getArray().filter(e=>e instanceof ol.layer.Label).forEach(e=>{const t=e.get("title");t==selectedOpt?e.setVisible(!0):e.setVisible(!1)}))},ol.control.LayerMenu.prototype.activateLayer=function(e){void 0!=e.target.value&&(selectedOpt=e.target.value,checked=e.target.checked,this.state.layers.getArray().filter(e=>!(e instanceof ol.layer.Label)).forEach(e=>{const t=e.get("title");t==selectedOpt?e.setVisible(!0):e.setVisible(!1)}))},ol.control.LayerMenu.prototype.openMenu=function(){this.getMap().getLayers();this.btn.innerHTML="X",this.container.classList.remove("ol-collapsed"),""==this.menu.innerHTML&&this.renderMenuContents()},ol.control.LayerMenu.prototype.closeMenu=function(){this.getMap().getLayers();this.container.classList.add("ol-collapsed"),this.btn.innerHTML="&#9776;"},ol.control.LayerMenu.prototype.renderMenuContents=function(){var e=document.createElement("div");e.innerHTML="<h5>Tiles</h5>";var t=document.createElement("ul");this.state.layers=map.getLayers(),this.state.layers.forEach(function(e,n,o){if(!(e instanceof ol.layer.Label||void 0==e.get("title"))){var i=e.get("title"),a=e.getVisible(),l=document.createElement("li"),r=document.createElement("label"),s=document.createElement("input");s.setAttribute("type","radio"),s.setAttribute("name","tiles"),s.setAttribute("value",i),s.checked=a,r.appendChild(s);var c=document.createElement("span");c.innerHTML=i,r.appendChild(c),l.appendChild(r),t.appendChild(l)}}),e.appendChild(t),this.menu.appendChild(e),ol.events.listen(e,ol.events.EventType.CLICK,this.activateLayer,this);var n=document.createElement("div");n.innerHTML="<h5>Labels</h5>";var o=document.createElement("ul");this.state.layers.forEach(function(e,t){if(e instanceof ol.layer.Label&&void 0!=e.get("title")){var n=e.get("title"),i=e.getVisible(),a=document.createElement("li"),l=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","radio"),r.setAttribute("name","labels"),r.setAttribute("value",n),r.checked=i,l.appendChild(r);var s=document.createElement("span");s.innerHTML=n,l.appendChild(s),a.appendChild(l),o.appendChild(a)}}),n.appendChild(o),this.menu.appendChild(n),ol.events.listen(n,ol.events.EventType.CLICK,this.activateLayerLabel,this)},ol.layer.Label=function(e){var t=e||{};t.style||(t.style=ol.style.labelStyle),void 0===t.updateWhileAnimating&&(t.updateWhileAnimating=!0),void 0===t.updateWhileInteracting&&(t.updateWhileInteracting=!0),ol.layer.Vector.call(this,t)},ol.inherits(ol.layer.Label,ol.layer.Vector);const ICON_TYPE="icon",TEXT_TYPE="text",ICON_MAPPING={aboriginal:"buddhist.svg",administration:"town_hall.svg",airport:"aerodrome.12.svg",artgallery:"artwork.svg",assortment:"buddhist.svg",atm:"atm.svg",bank:"bank.svg",bar:"bar.svg",bbq:"picnic.svg",beergarden:"biergarten.svg",bicycle_shop:"shop/bicycle.svg",boat:"buddhist.svg",breastfeeding:"buddhist.svg",bus:"bus_stop.12.svg",cafeteria:"shop/coffee.svg",car:"shop/car.svg",car_share:"rental_car.svg",casino:"buddhist.svg",catholicgrave:"grave_yard_christian.svg",church:"christian.svg",cinema:"cinema.svg",clock:"buddhist.svg",coffee:"shop/coffee.svg",communitycentre:"community_centre.svg",congress:"town_hall.svg",court:"courthouse.svg",dance_class:"buddhist.svg",dancinghall:"buddhist.svg",daycare:"buddhist.svg",dentist:"dentist.svg",drinkingfountain:"fountain.svg","e-bike-charging":"charging_station.svg",fast_food:"fast_food.svg",ferry:"ferry.svg",fillingstation:"fuel.svg",firemen:"firestation.svg",firstaid:"buddhist.svg",fountain:"fountain.svg",hospital:"hospital.svg",ice_cream:"shop/ice_cream.svg",library:"library.svg",market:"shop/supermarket.svg",medicalstore:"pharmacy.svg",medicine:"pharmacy.svg",music_classical:"shop/musical_instrument.svg",nursing_home_icon:"buddhist.svg",parking:"parking.svg",parking_bicycle:"bicycle_parking.svg",perfumery:"shop/perfumery.svg",police:"police.svg",postal:"post_office.svg",restaurant:"restaurant.svg",sauna:"buddhist.svg",school:"buddhist.svg",spa:"buddhist.svg",stripclub:"buddhist.svg",taxi:"taxi.svg",telephone:"telephone.svg",theatre:"theatre.svg",toilets:"toilets.svg",tools:"buddhist.svg",trash:"waste_basket.10.svg",undefined:"buddhist.svg",university:"buddhist.svg",veterinary:"veterinary.svg",waiting:"bench.svg",wifi:"buddhist.svg",workoffice:"buddhist.svg"},ICON_URL="https://rawgit.com/gravitystorm/openstreetmap-carto/master/symbols/";ol.Label=function(e,t){this.text=e.get("name"),this.t=e.get("t"),this.factor=e.get("lbl_fac"),this.resolveType(),this.min_t=resolutionToMinT(t)},ol.Label.prototype.resolveType=function(){if(this.text.includes("icon:")){this.type="icon";var e=this.text.replace("icon:","");this.iconUrl=this.getIconURL(e)}else this.type="text"},ol.Label.prototype.render=function(){var e=null;if(this.min_t>this.t)return null;var t=window.labelFacCoeff*parseInt(this.factor),n=t+"px Consolas";this.text.indexOf("\\")>=0&&(this.text=this.text.replace("\\n","\n"));var o=t*this.getMaxLabelLength(this.text)*.26,i=new ol.style.Circle({radius:o,stroke:new ol.style.Stroke({color:"red"})});if("icon"==this.type)e=new ol.style.Style({image:new ol.style.Icon({crossOrigin:"anonymous",src:this.iconUrl})});else if("text"==this.type){var a=new ol.style.Text({text:this.text,font:n,stroke:new ol.style.Stroke({color:"#333",width:4}),fill:new ol.style.Fill({color:"#fff"})});e=new ol.style.Style({image:1==window.debugDrawCirc?i:null,text:a})}return e},ol.Label.prototype.getIconURL=function(e){let t=ICON_MAPPING.undefined;return void 0!==ICON_MAPPING[e]&&(t=ICON_MAPPING[e]),ICON_URL+t},ol.Label.prototype.getMaxLabelLength=function(e){for(var t=e.split("\n"),n=0,o=t.length,i=0;i<o;i++)n<t[i].length&&(n=t[i].length);return n},ol.style.labelStyle=function(e,t){return new ol.Label(e,t).render()},ol.source.Label=function(e){this.labelServerUrl=e.url,e.format=new ol.format.GeoJSON,e.strategy=ol.loadingstrategy.bbox,e.url=this.featureLoader.bind(this),e.updateWhileAnimating=!0,e.updateWhileInteracting=!0,ol.source.Vector.call(this,e)},ol.source.Label.prototype=Object.create(ol.source.Vector.prototype),ol.source.Label.prototype.addFeatureInternal=function(e){var t=e.get("osm");if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var n=e.getGeometry();if(n){var o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.ADDFEATURE,e))}},ol.source.Label.prototype.loadFeatures=function(e,t,n){var o,i,a=this.loadedExtentsRtree_,l=this.strategy_(e,t);for(o=0,i=l.length;o<i;++o){var r=l[o];a.forEachInExtent(r,function(e){return ol.extent.containsExtent(e.extent,r)&&t==e.resolution})||(this.loader_.call(this,r,t,n),a.insert(r,{extent:r.slice(),resolution:t}))}},ol.source.Label.prototype.constructor=ol.source.Label,ol.source.Label.prototype.featureLoader=function(e,t,n){var o=ol.proj.toLonLat(e.slice(0,2)),i=ol.proj.toLonLat(e.slice(2,4)),a=resolutionToMinT(t),l={x_min:o[0],x_max:i[0],y_min:o[1],y_max:i[1],t_min:a};return this.buildQuery(l)},ol.source.Label.prototype.buildQuery=function(e){void 0!==e&&"object"==typeof e||(e={});var t="?",n=0;for(var o in e){n++;var i=o,a=e[o];t+=1==n?i+"="+a:"&"+i+"="+a}return this.labelServerUrl+t};